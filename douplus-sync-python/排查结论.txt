===============================================================================
DOU+订单效果数据显示问题 - 排查结论
===============================================================================

## 问题现象
前端"我的订单"页面，投放中订单的效果数据（播放量、点赞、转化等）显示为空

## 排查结果

### 1. 数据库表结构 ❌
douplus_order表**不包含**效果数据字段：
- 表中只有：order_id, item_id, status, budget, duration等基础字段
- 缺少：play_count, like_count, share_count, comment_count等效果数据字段

### 2. 抖音订单列表API ❌  
get_order_list() API **不返回**效果数据：
- 返回结构：{ad_list, item_info_list, order}
- order对象包含：order_id, task_id, budget, task_status等基础信息
- **不包含任何效果数据字段**

### 3. 抖音效果报告API ❌
get_order_report() API虽然返回效果数据，但：
- 只返回已完成/历史订单的数据
- **不返回投放中（DELIVERING）订单的实时效果数据**
- 测试结果：所有投放中订单的效果数据都是0

### 4. Celery定时任务 ✅
定时任务配置正确：
- 每5分钟增量同步订单（sync_all_accounts_incremental）
- 每5分钟同步效果数据（sync_all_accounts_stats）
- 每5分钟聚合视频数据（aggregate_current_window）

## 根本原因

**系统架构设计缺陷：**

1. **订单基础信息与效果数据分离存储**
   - douplus_order表：存储订单基础信息
   - douplus_video_stats_agg表：存储效果数据（按视频ID聚合）
   - 两者通过item_id关联

2. **抖音API限制**
   - 订单列表API不返回效果数据
   - 效果报告API对投放中订单返回数据为0（数据延迟）

3. **数据流断裂**
   - 投放中订单在douplus_order表中存在
   - 但douplus_video_stats_agg表中没有对应的视频效果数据
   - 查询层JOIN时无法获取效果数据

## 解决方案

### 方案A：等待抖音API数据就绪（不推荐）
- 等待订单完成后，效果报告API才会返回完整数据
- **缺点**：投放中订单无法实时显示效果

### 方案B：修改表结构，订单表直接存储效果数据（推荐）
**修改内容：**
1. 在douplus_order表增加效果数据字段
2. 订单同步时调用效果报告API获取数据
3. 查询层直接从订单表读取，不需要JOIN

**优点：**
- 数据结构简单，查询高效
- 投放中订单可显示实时效果（如果API有返回）

**缺点：**
- 需要DDL变更（ALTER TABLE）
- 需要修改Sync层和Query层代码

### 方案C：前端调用独立的效果数据API
- 保持现有表结构不变
- 前端先查订单列表，再查效果数据
- **缺点**：增加前端复杂度和请求次数

===============================================================================
推荐实施方案B
===============================================================================
