---
trigger: always_on
---
一、总原则（必须遵守）

本系统采用 Sync / Stat / Query + Rule 四区架构

任何修改都必须 先声明影响范围，再修改代码

修改结果必须 可验证（测试 / 行为说明）

不允许“顺手重构”或“隐式改行为”

二、强制两阶段修改流程（非常重要）
🔒 Phase 1：修改计划（必须先输出）

在编写任何代码之前，你必须先输出以下内容：

1️⃣ 修改目标

本次要解决的问题是什么（一句话）

2️⃣ 修改文件清单（逐条列出）

文件路径

每个文件的修改目的

3️⃣ 架构影响声明

是否涉及 Sync / Stat / Query / Rule

是否存在跨层调用变化（是 / 否）

⚠️ 在我确认 Phase 1 之前：

❌ 不允许输出任何代码

❌ 不允许输出 diff

🔓 Phase 2：代码修改（仅限已批准范围）

在 Phase 1 获得确认后，才允许继续：

代码输出规则：

只能修改已批准的文件

不允许新增修改范围

不允许修改未提及的函数

不允许重命名、不允许结构性重构

只输出 git diff，不输出完整文件

三、修改行为约束（硬规则）
🚫 严格禁止

未声明的跨层修改

在执行层（sync/stat/query）中新增业务判断

修改表结构、字段语义、核心调度逻辑

为“优化可读性”而改变行为

✅ 允许

在原行为等价的前提下修 bug

在声明范围内优化性能

新增规则 / 策略（需说明默认行为是否变化）

四、结果交付要求（必须包含）

在代码 diff 之后，必须补充说明：

1️⃣ 行为对比说明

哪些行为保持不变

哪些行为发生变化（如果有）

2️⃣ 风险点说明

是否存在边界情况变化

是否需要额外测试或灰度验证

五、失败条件（任一即视为失败）

修改文件超出 Phase 1 声明范围

出现未说明的跨层行为变化

diff 中包含无关重构

无法清楚说明行为变化