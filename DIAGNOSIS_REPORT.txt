========================================
DOU+ è®¢å•æ•°æ®é—®é¢˜è¯Šæ–­æŠ¥å‘Š
========================================
ç”Ÿæˆæ—¶é—´: 2026-01-26 12:15

## é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆ: è½¬åŒ–æˆæœ¬ã€è½¬åŒ–æ•°ã€5Så®Œæ’­ç‡è¿™ä¸‰ä¸ªæŒ‡æ ‡æ²¡æœ‰æ•°æ®

## æ ¹æœ¬åŸå›  âœ“ å·²æ‰¾åˆ°

### 1. APIè¿”å›æ•°æ®æ­£å¸¸ âœ“
ä»æ—¥å¿—å¯ä»¥çœ‹åˆ°,æŠ–éŸ³APIç¡®å®è¿”å›äº†è¿™3ä¸ªå­—æ®µ:
```json
{
  "custom_convert_cost": 1667,     // è½¬åŒ–æˆæœ¬(åˆ†) âœ“
  "dp_target_convert_cnt": 6,      // è½¬åŒ–æ•° âœ“  
  "play_duration_5s_rank": 0.36    // 5ç§’å®Œæ’­ç‡ âœ“
}
```

### 2. ä»£ç è§£ææ­£å¸¸ âœ“
DouyinAdClient.java æ­£ç¡®è§£æäº†è¿™3ä¸ªå­—æ®µ:
- custom_convert_cost â†’ customConvertCost (è½¬ä¸ºå…ƒ)
- dp_target_convert_cnt â†’ dpTargetConvertCnt
- play_duration_5s_rank â†’ playDuration5sRank

### 3. Serviceå±‚æ›´æ–°é€»è¾‘æœ‰BUG âœ— (å·²ä¿®å¤)

**æ—§ä»£ç **:
```java
if (stats.getPlayDuration5sRank() != null && stats.getPlayDuration5sRank() > 0) {
    task.setPlayDuration5sRank(stats.getPlayDuration5sRank());
}
if (stats.getDpTargetConvertCnt() != null && stats.getDpTargetConvertCnt() > 0) {
    task.setDpTargetConvertCnt(stats.getDpTargetConvertCnt());
}
if (stats.getCustomConvertCost() != null && stats.getCustomConvertCost().compareTo(BigDecimal.ZERO) > 0) {
    task.setCustomConvertCost(stats.getCustomConvertCost());
}
```

**é—®é¢˜**: 
- æ·»åŠ äº† `> 0` æ¡ä»¶åˆ¤æ–­
- å¯¼è‡´å€¼ä¸º0çš„æ•°æ®ä¸ä¼šè¢«ä¿å­˜åˆ°æ•°æ®åº“
- ä¾‹å¦‚: æŸè®¢å•è½¬åŒ–æ•°ä¸º0æ—¶,è¿™ä¸ª0å€¼ä¸ä¼šè¢«æ›´æ–°,æ•°æ®åº“ä¿æŒNULLæˆ–æ—§å€¼

**ä¿®å¤å**:
```java
if (stats.getPlayDuration5sRank() != null) {
    task.setPlayDuration5sRank(stats.getPlayDuration5sRank());
}
if (stats.getDpTargetConvertCnt() != null) {
    task.setDpTargetConvertCnt(stats.getDpTargetConvertCnt());
}
if (stats.getCustomConvertCost() != null) {
    task.setCustomConvertCost(stats.getCustomConvertCost());
}
```

### 4. æ•°æ®åº“ç°çŠ¶ âœ—

æŸ¥è¯¢ç»“æœ:
```
æ€»è®¢å•æ•°:         1972æ¡
æœ‰5ç§’å®Œæ’­ç‡:       494æ¡ (25%)  â† 75%ç¼ºå¤±!
æœ‰è½¬åŒ–æ•°:         488æ¡ (24.7%) â† 75%ç¼ºå¤±!
æœ‰è½¬åŒ–æˆæœ¬:       485æ¡ (24.6%) â† 75%ç¼ºå¤±!
æœ‰æ’­æ”¾é‡:         494æ¡ (25%)
```

**åˆ†æ**:
- çº¦75%çš„è®¢å•(1478æ¡)çš„è¿™3ä¸ªå­—æ®µä¸º0æˆ–NULL
- è¿™äº›è®¢å•æ˜¯åœ¨æ—§ç‰ˆæœ¬ä»£ç (æœ‰>0æ¡ä»¶)ä¸‹åŒæ­¥çš„
- å³ä½¿APIè¿”å›äº†æ•°æ®,ä¹Ÿå› ä¸º>0æ¡ä»¶è¢«è¿‡æ»¤æ‰äº†

## è§£å†³æ–¹æ¡ˆ âœ“

### âœ… å·²å®Œæˆçš„ä¿®å¤:
1. ç§»é™¤Serviceå±‚çš„ `> 0` æ¡ä»¶åˆ¤æ–­
2. é‡æ–°ç¼–è¯‘å¹¶éƒ¨ç½²æ–°ç‰ˆæœ¬ä»£ç  (PID: 1716550)
3. ä¿®æ”¹å‰ç«¯æ˜¾ç¤ºæ ¼å¼(ç‚¹èµæ¯”ã€è½¬å‘æ¯”æ”¹ä¸ºç™¾åˆ†æ¯”)

### ğŸ”„ å¾…æ‰§è¡Œçš„æ“ä½œ:
**éœ€è¦é‡æ–°åŒæ­¥å†å²è®¢å•æ•°æ®**,è®©æ–°ä»£ç é‡æ–°å¤„ç†:

æ–¹æ³•1: å‰ç«¯æ‰‹åŠ¨åŒæ­¥(æ¨è)
- ç™»å½•ç³»ç»Ÿ
- ç‚¹å‡»"åŒæ­¥å†å²è®¢å•"æŒ‰é’®
- ç­‰å¾…åŒæ­¥å®Œæˆ(çº¦1-2åˆ†é’Ÿ)

æ–¹æ³•2: ç­‰å¾…è‡ªåŠ¨åŒæ­¥
- ç³»ç»Ÿæ¯å°æ—¶è‡ªåŠ¨åŒæ­¥ä¸€æ¬¡
- ä¸‹æ¬¡åŒæ­¥æ—¶é—´: 13:00å·¦å³
- ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°ä»£ç æ›´æ–°æ‰€æœ‰è®¢å•

æ–¹æ³•3: APIæ‰‹åŠ¨è§¦å‘
- éœ€è¦ç™»å½•åè·å–token
- POST /api/douyin/sync

## é¢„æœŸæ•ˆæœ

åŒæ­¥å®Œæˆå:
- æ‰€æœ‰1972æ¡è®¢å•çš„3ä¸ªå­—æ®µéƒ½ä¼šæœ‰æ­£ç¡®çš„å€¼
- å³ä½¿å€¼ä¸º0,ä¹Ÿä¼šæ˜¾ç¤ºä¸º0,è€Œä¸æ˜¯ç©ºç™½
- å‰ç«¯è®¢å•åˆ—è¡¨ä¸­è¿™3åˆ—å°†æ­£å¸¸æ˜¾ç¤ºæ•°æ®

## éªŒè¯æ–¹æ³•

åŒæ­¥åæ‰§è¡Œä»¥ä¸‹SQLæŸ¥è¯¢:
```sql
SELECT 
    COUNT(*) as total,
    COUNT(CASE WHEN play_duration_5s_rank > 0 THEN 1 END) as has_5s_rank,
    COUNT(CASE WHEN dp_target_convert_cnt > 0 THEN 1 END) as has_convert,
    COUNT(CASE WHEN custom_convert_cost > 0 THEN 1 END) as has_cost
FROM douplus_task 
WHERE order_id IS NOT NULL;
```

é¢„æœŸç»“æœ: has_5s_rank, has_convert, has_cost çš„æ•°é‡åº”è¯¥æ¥è¿‘ total

========================================
æŠ¥å‘Šç»“æŸ
========================================
